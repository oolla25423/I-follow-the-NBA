{% extends 'base.html' %}
{% load static %}
{% load i18n_fallback %}

{% block title %}{{ team.name }} - Basketball Fans{% endblock %}

{% block content %}
<div class="container">
    <div class="team-detail-header">
        <a href="{% url 'home' %}" class="back-link">
            <i class="fas fa-arrow-left"></i>
            {% trans "Back to Teams" %}
        </a>
        
        <div class="team-hero">
            <div class="team-logo-large">
                <div class="team-initials-large" style="background: linear-gradient(135deg, {{ team.colors.0 }}, {{ team.colors.1|default:team.colors.0 }})">
                </div>
            </div>
            
            <div class="team-hero-info">
                <h1>{{ team.name }}</h1>
                <p class="team-location">
                    <i class="fas fa-map-marker-alt"></i>
                    {{ team.city }}
                </p>
                
                <div class="team-badges">
                    <span class="badge conference-badge">{{ team.conference }} {% trans "Conference" %}</span>
                    <span class="badge division-badge">{{ team.division }} {% trans "Division" %}</span>
                    {% if team.championships > 0 %}
                    <span class="badge championship-badge">
                        <i class="fas fa-trophy"></i>
                        {{ team.championships }} {% trans "Championships" %}
                    </span>
                    {% endif %}
                </div>
                
                <button class="btn-favorite {% if team.is_favorite %}active{% endif %}" 
                        onclick="toggleFavorite({{ team.id }})"
                        title="{% if team.is_favorite %}Remove from favorites{% else %}Add to favorites{% endif %}">
                    <i class="{% if team.is_favorite %}fas{% else %}far{% endif %} fa-heart"></i>
                    {% if team.is_favorite %}{% trans "Remove from Favorites" %}{% else %}{% trans "Add to Favorites" %}{% endif %}
                </button>
            </div>
        </div>
    </div>

    <div class="team-detail-content">
        <div class="detail-grid">
            <div class="detail-section">
                <h2><i class="fas fa-info-circle"></i> {% trans "Team Information" %}</h2>
                
                <div class="info-grid">
                    <div class="info-item">
                        <div class="info-label">{% trans "Founded" %}</div>
                        <div class="info-value">{{ team.founded }}</div>
                    </div>
                    
                    <div class="info-item">
                        <div class="info-label">{% trans "Conference" %}</div>
                        <div class="info-value">{{ team.conference }}</div>
                    </div>
                    
                    <div class="info-item">
                        <div class="info-label">{% trans "Division" %}</div>
                        <div class="info-value">{{ team.division }}</div>
                    </div>
                    
                    <div class="info-item">
                        <div class="info-label">{% trans "Championships" %}</div>
                        <div class="info-value">
                            {{ team.championships }}
                            {% if team.championships > 0 %}
                            <i class="fas fa-trophy text-gold"></i>
                            {% endif %}
                        </div>
                    </div>
                </div>
                
                <div class="team-description-section">
                    <h3>{% trans "About" %} {{ team.name }}</h3>
                    <p>{{ team.description }}</p>
                </div>
            </div>
            
            <div class="detail-section">
                <h2><i class="fas fa-palette"></i> {% trans "Team Colors" %}</h2>
                
                <div class="colors-showcase">
                    {% for color in team.colors %}
                    <div class="color-display">
                        <div class="color-circle" style="background-color: {{ color }};"></div>
                        <div class="color-code">{{ color }}</div>
                    </div>
                    {% endfor %}
                </div>
                
                <div class="color-preview" style="background: linear-gradient(135deg, {{ team.colors.0 }}, {{ team.colors.1|default:team.colors.0 }});">
                    <div class="color-preview-text">
                        <h3>{{ team.name }}</h3>
                        <p>{% trans "Team Colors Preview" %}</p>
                    </div>
                </div>
            </div>
        </div>
        
        <div class="team-stats-section">
            <h2><i class="fas fa-chart-bar"></i> {% trans "Quick Stats" %}</h2>
            
            <div class="stats-grid">
                <div class="stat-card">
                    <div class="stat-icon">
                        <i class="fas fa-calendar-alt"></i>
                    </div>
                    <div class="stat-info">
                        <div class="stat-number">{{ team.founded }}</div>
                        <div class="stat-label">{% trans "Founded" %}</div>
                    </div>
                </div>
                
                <div class="stat-card">
                    <div class="stat-icon">
                        <i class="fas fa-trophy"></i>
                    </div>
                    <div class="stat-info">
                        <div class="stat-number">{{ team.championships }}</div>
                        <div class="stat-label">{% trans "Championships" %}</div>
                    </div>
                </div>
                
                <div class="stat-card">
                    <div class="stat-icon">
                        <i class="fas fa-map"></i>
                    </div>
                    <div class="stat-info">
                        <div class="stat-number">{{ team.conference|slice:":1" }}</div>
                        <div class="stat-label">{% trans "Conference" %}</div>
                    </div>
                </div>
                
                <div class="stat-card">
                    <div class="stat-icon">
                        <i class="fas fa-layer-group"></i>
                    </div>
                    <div class="stat-info">
                        <div class="stat-number">{{ team.division|slice:":3" }}</div>
                        <div class="stat-label">{% trans "Division" %}</div>
                    </div>
                </div>
            </div>
        </div>
        
        <div class="actions-section">
            <h2><i class="fas fa-share-alt"></i> {% trans "Actions" %}</h2>
            
            <div class="action-buttons">
                <button class="btn btn-secondary" onclick="shareTeam()">
                    <i class="fas fa-share"></i>
                    {% trans "Share Team" %}
                </button>
                
                <a href="{% url 'home' %}" class="btn btn-outline">
                    <i class="fas fa-list"></i>
                    {% trans "View All Teams" %}
                </a>
                
                <button class="btn btn-outline" onclick="printTeamInfo()">
                    <i class="fas fa-print"></i>
                    {% trans "Print Info" %}
                </button>
            </div>
        </div>
    </div>
</div>

<!-- Toast notification -->
<div id="toast" class="toast">
    <div class="toast-content">
        <i class="toast-icon"></i>
        <span class="toast-message"></span>
    </div>
</div>
{% endblock %}

{% block extra_js %}
<script>
function toggleFavorite(teamId) {
    fetch('{% url "toggle_favorite" %}', {
        method: 'POST',
        headers: {
            'Content-Type': 'application/json',
            'X-CSRFToken': window.csrfToken
        },
        body: JSON.stringify({
            team_id: teamId
        })
    })
    .then(response => response.json())
    .then(data => {
        if (data.success) {
            updateFavoriteUI(data.is_favorite, data.favorite_count);
            showToast(data.is_favorite ? 'Added to favorites!' : 'Removed from favorites!', 'success');
        } else {
            showToast('Error updating favorites', 'error');
        }
    })
    .catch(error => {
        console.error('Error:', error);
        showToast('Network error', 'error');
    });
}

function updateFavoriteUI(isFavorite, favoriteCount) {
    const favoriteBtn = document.querySelector('.btn-favorite');
    const heartIcon = favoriteBtn.querySelector('i');
    
    // Update button state
    if (isFavorite) {
        favoriteBtn.classList.add('active');
        heartIcon.classList.remove('far');
        heartIcon.classList.add('fas');
        favoriteBtn.innerHTML = '<i class="fas fa-heart"></i> Remove from Favorites';
        favoriteBtn.title = 'Remove from favorites';
    } else {
        favoriteBtn.classList.remove('active');
        heartIcon.classList.remove('fas');
        heartIcon.classList.add('far');
        favoriteBtn.innerHTML = '<i class="far fa-heart"></i> Add to Favorites';
        favoriteBtn.title = 'Add to favorites';
    }
    
    // Update counters
    updateFavoriteCounters(favoriteCount);
}

function updateFavoriteCounters(count) {
    const counters = document.querySelectorAll('#favorites-count, #footer-favorites-count');
    counters.forEach(counter => {
        if (counter) counter.textContent = count;
    });
}

function showToast(message, type) {
    const toast = document.getElementById('toast');
    const icon = toast.querySelector('.toast-icon');
    const messageEl = toast.querySelector('.toast-message');
    
    // Set message
    messageEl.textContent = message;
    
    // Set icon based on type
    icon.className = `toast-icon fas ${type === 'success' ? 'fa-check-circle' : 'fa-exclamation-circle'}`;
    
    // Set theme
    toast.className = `toast ${type}`;
    
    // Show toast
    toast.classList.add('show');
    
    // Hide after 3 seconds
    setTimeout(() => {
        toast.classList.remove('show');
    }, 3000);
}

function shareTeam() {
    if (navigator.share) {
        navigator.share({
            title: '{{ team.name }}',
            text: '{{ team.description }}',
            url: window.location.href
        });
    } else {
        // Fallback - copy to clipboard
        navigator.clipboard.writeText(window.location.href).then(() => {
            showToast('Team link copied to clipboard!', 'success');
        });
    }
}

function printTeamInfo() {
    window.print();
}
</script>
{% endblock %}