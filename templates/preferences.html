{% extends 'base.html' %}
{% load static %}

{% block title %}Settings - Basketball Fans{% endblock %}

{% block content %}
<div class="container">
    <div class="preferences-header">
        <h1><i class="fas fa-cog"></i> User Settings</h1>
        <p>Configure your preferences for a better experience</p>
    </div>

    <form method="post" class="preferences-form">
        {% csrf_token %}
        
        <!-- Секция выбора любимых команд -->
        <div class="form-section">
            <h2><i class="fas fa-heart"></i> Favorite Teams</h2>
            <p class="section-description">Choose the teams you want to follow</p>
            
            <div class="teams-selection">
                {% for team in all_teams %}
                <div class="team-checkbox">
                    <input type="checkbox" 
                           id="team-{{ team.id }}" 
                           name="favorite_teams" 
                           value="{{ team.id }}"
                           {% if team.id|stringformat:'s' in favorite_team_ids %}checked{% endif %}>
                    <label for="team-{{ team.id }}" class="team-label">
                        <div class="team-card-mini">
                            <img src="{% static 'images/teams/' %}{{ team.logo }}" 
                                 alt="{{ team.name }}" 
                                 class="team-logo-small"
                                 onerror="this.src='{% static 'images/default-team.png' %}'">
                            <div class="team-info-mini">
                                <strong>{{ team.name }}</strong>
                                <span class="team-league-mini">{{ team.league }}</span>
                                <span class="team-country-mini">{{ team.country }}</span>
                            </div>
                        </div>
                    </label>
                </div>
                {% endfor %}
            </div>
            
            <div class="selection-controls">
                <button type="button" class="btn btn-outline" onclick="selectAllTeams()">
                    <i class="fas fa-check-double"></i> Select All
                </button>
                <button type="button" class="btn btn-outline" onclick="clearAllTeams()">
                    <i class="fas fa-times"></i> Clear All
                </button>
            </div>
        </div>

        <!-- Секция настройки языка -->
        <div class="form-section">
            <h2><i class="fas fa-globe"></i> Interface Language</h2>
            <p class="section-description">Choose your preferred language</p>
            
            <div class="language-selection">
                {% for lang_code, lang_name in language_choices %}
                <div class="radio-option">
                    <input type="radio" 
                           id="lang-{{ lang_code }}" 
                           name="language" 
                           value="{{ lang_code }}"
                           {% if lang_code == current_language %}checked{% endif %}>
                    <label for="lang-{{ lang_code }}" class="radio-label">
                        <div class="language-option">
                            <span class="language-flag">
                                {% if lang_code == 'en' %}🇺🇸{% elif lang_code == 'ru' %}🇷🇺{% endif %}
                            </span>
                            <span class="language-name">{{ lang_name }}</span>
                        </div>
                    </label>
                </div>
                {% endfor %}
            </div>
        </div>

        <!-- Секция выбора темы -->
        <div class="form-section">
            <h2><i class="fas fa-palette"></i> Design Theme</h2>
            <p class="section-description">Choose the site color scheme</p>
            
            <div class="theme-selection">
                {% for theme_code, theme_name in theme_choices %}
                <div class="radio-option">
                    <input type="radio" 
                           id="theme-{{ theme_code }}" 
                           name="theme" 
                           value="{{ theme_code }}"
                           {% if theme_code == current_theme %}checked{% endif %}>
                    <label for="theme-{{ theme_code }}" class="radio-label">
                        <div class="theme-option" data-theme="{{ theme_code }}">
                            <div class="theme-preview">
                                <div class="theme-color theme-primary"></div>
                                <div class="theme-color theme-secondary"></div>
                                <div class="theme-color theme-background"></div>
                            </div>
                            <span class="theme-name">{{ theme_name }}</span>
                        </div>
                    </label>
                </div>
                {% endfor %}
            </div>
        </div>

        <!-- Action buttons -->
        <div class="form-actions">
            <button type="submit" class="btn btn-primary">
                <i class="fas fa-save"></i> Save Settings
            </button>
            <a href="{% url 'home' %}" class="btn btn-outline">
                <i class="fas fa-arrow-left"></i> Back
            </a>
            <button type="button" class="btn btn-danger" onclick="resetSettings()">
                <i class="fas fa-undo"></i> Reset
            </button>
        </div>
    </form>

    <!-- Current settings information -->
    <div class="current-settings">
        <h3><i class="fas fa-info-circle"></i> Current Settings</h3>
        <div class="settings-info">
            <p><strong>Favorite Teams:</strong> {{ favorite_team_ids|length }}</p>
            <p><strong>Language:</strong> 
                {% for lang_code, lang_name in language_choices %}
                    {% if lang_code == current_language %}{{ lang_name }}{% endif %}
                {% endfor %}
            </p>
            <p><strong>Theme:</strong> 
                {% for theme_code, theme_name in theme_choices %}
                    {% if theme_code == current_theme %}{{ theme_name }}{% endif %}
                {% endfor %}
            </p>
            <p><strong>Last Visit:</strong> 
                {% if request.COOKIES.last_visited %}
                    {{ request.COOKIES.last_visited }}
                {% else %}
                    First visit
                {% endif %}
            </p>
        </div>
    </div>
</div>
{% endblock %}

{% block extra_js %}
<script>
function selectAllTeams() {
    const checkboxes = document.querySelectorAll('input[name="favorite_teams"]');
    checkboxes.forEach(checkbox => {
        checkbox.checked = true;
    });
}

function clearAllTeams() {
    const checkboxes = document.querySelectorAll('input[name="favorite_teams"]');
    checkboxes.forEach(checkbox => {
        checkbox.checked = false;
    });
}

function resetSettings() {
    if (confirm('Are you sure you want to reset all settings?')) {
        // Clear all team checkboxes
        clearAllTeams();
        
        // Reset language to English
        document.getElementById('lang-en').checked = true;
        
        // Reset theme to light
        document.getElementById('theme-light').checked = true;
        ThemeManager.setTheme('light');
    }
}

// Предварительный просмотр темы
document.querySelectorAll('input[name="theme"]').forEach(radio => {
    radio.addEventListener('change', function() {
        if (this.checked) {
            document.body.setAttribute('data-theme', this.value);
        }
    });
});

// Анимация при выборе команд
document.querySelectorAll('.team-checkbox input').forEach(checkbox => {
    checkbox.addEventListener('change', function() {
        const label = this.nextElementSibling;
        if (this.checked) {
            label.classList.add('selected');
        } else {
            label.classList.remove('selected');
        }
    });
});

// Инициализация выбранных команд при загрузке
document.addEventListener('DOMContentLoaded', function() {
    document.querySelectorAll('.team-checkbox input:checked').forEach(checkbox => {
        checkbox.nextElementSibling.classList.add('selected');
    });
});
</script>
{% endblock %}