{% extends 'base.html' %}
{% load static %}

{% block title %}–ù–∞—Å—Ç—Ä–æ–π–∫–∏ - –°–ø–æ—Ä—Ç–∏–≤–Ω—ã–µ –§–∞–Ω–∞—Ç—ã{% endblock %}

{% block content %}
<div class="container">
    <div class="preferences-header">
        <h1><i class="fas fa-cog"></i> –ù–∞—Å—Ç—Ä–æ–π–∫–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è</h1>
        <p>–ù–∞—Å—Ç—Ä–æ–π—Ç–µ —Å–≤–æ–∏ –ø—Ä–µ–¥–ø–æ—á—Ç–µ–Ω–∏—è –¥–ª—è –ª—É—á—à–µ–≥–æ –æ–ø—ã—Ç–∞ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è</p>
    </div>

    <form method="post" class="preferences-form">
        {% csrf_token %}
        
        <!-- –°–µ–∫—Ü–∏—è –≤—ã–±–æ—Ä–∞ –ª—é–±–∏–º—ã—Ö –∫–æ–º–∞–Ω–¥ -->
        <div class="form-section">
            <h2><i class="fas fa-heart"></i> –õ—é–±–∏–º—ã–µ –∫–æ–º–∞–Ω–¥—ã</h2>
            <p class="section-description">–í—ã–±–µ—Ä–∏—Ç–µ –∫–æ–º–∞–Ω–¥—ã, –∑–∞ –∫–æ—Ç–æ—Ä—ã–º–∏ —Ö–æ—Ç–∏—Ç–µ —Å–ª–µ–¥–∏—Ç—å</p>
            
            <div class="teams-selection">
                {% for team in all_teams %}
                <div class="team-checkbox">
                    <input type="checkbox" 
                           id="team-{{ team.id }}" 
                           name="favorite_teams" 
                           value="{{ team.id }}"
                           {% if team.id|stringformat:'s' in favorite_team_ids %}checked{% endif %}>
                    <label for="team-{{ team.id }}" class="team-label">
                        <div class="team-card-mini">
                            <img src="{% static 'images/teams/' %}{{ team.logo }}" 
                                 alt="{{ team.name }}" 
                                 class="team-logo-small"
                                 onerror="this.src='{% static 'images/default-team.png' %}'">
                            <div class="team-info-mini">
                                <strong>{{ team.name }}</strong>
                                <span class="team-league-mini">{{ team.league }}</span>
                                <span class="team-country-mini">{{ team.country }}</span>
                            </div>
                        </div>
                    </label>
                </div>
                {% endfor %}
            </div>
            
            <div class="selection-controls">
                <button type="button" class="btn btn-outline" onclick="selectAllTeams()">
                    <i class="fas fa-check-double"></i> –í—ã–±—Ä–∞—Ç—å –≤—Å–µ
                </button>
                <button type="button" class="btn btn-outline" onclick="clearAllTeams()">
                    <i class="fas fa-times"></i> –û—á–∏—Å—Ç–∏—Ç—å –≤—Å–µ
                </button>
            </div>
        </div>

        <!-- –°–µ–∫—Ü–∏—è –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ —è–∑—ã–∫–∞ -->
        <div class="form-section">
            <h2><i class="fas fa-globe"></i> –Ø–∑—ã–∫ –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–∞</h2>
            <p class="section-description">–í—ã–±–µ—Ä–∏—Ç–µ –ø—Ä–µ–¥–ø–æ—á–∏—Ç–∞–µ–º—ã–π —è–∑—ã–∫</p>
            
            <div class="language-selection">
                {% for lang_code, lang_name in language_choices %}
                <div class="radio-option">
                    <input type="radio" 
                           id="lang-{{ lang_code }}" 
                           name="language" 
                           value="{{ lang_code }}"
                           {% if lang_code == current_language %}checked{% endif %}>
                    <label for="lang-{{ lang_code }}" class="radio-label">
                        <div class="language-option">
                            <span class="language-flag">
                                {% if lang_code == 'en' %}üá∫üá∏{% elif lang_code == 'es' %}üá™üá∏
                                {% elif lang_code == 'fr' %}üá´üá∑{% elif lang_code == 'de' %}üá©üá™
                                {% elif lang_code == 'it' %}üáÆüáπ{% elif lang_code == 'ru' %}üá∑üá∫{% endif %}
                            </span>
                            <span class="language-name">{{ lang_name }}</span>
                        </div>
                    </label>
                </div>
                {% endfor %}
            </div>
        </div>

        <!-- –°–µ–∫—Ü–∏—è –≤—ã–±–æ—Ä–∞ —Ç–µ–º—ã -->
        <div class="form-section">
            <h2><i class="fas fa-palette"></i> –¢–µ–º–∞ –æ—Ñ–æ—Ä–º–ª–µ–Ω–∏—è</h2>
            <p class="section-description">–í—ã–±–µ—Ä–∏—Ç–µ —Ü–≤–µ—Ç–æ–≤—É—é —Å—Ö–µ–º—É —Å–∞–π—Ç–∞</p>
            
            <div class="theme-selection">
                {% for theme_code, theme_name in theme_choices %}
                <div class="radio-option">
                    <input type="radio" 
                           id="theme-{{ theme_code }}" 
                           name="theme" 
                           value="{{ theme_code }}"
                           {% if theme_code == current_theme %}checked{% endif %}>
                    <label for="theme-{{ theme_code }}" class="radio-label">
                        <div class="theme-option" data-theme="{{ theme_code }}">
                            <div class="theme-preview">
                                <div class="theme-color theme-primary"></div>
                                <div class="theme-color theme-secondary"></div>
                                <div class="theme-color theme-background"></div>
                            </div>
                            <span class="theme-name">{{ theme_name }}</span>
                        </div>
                    </label>
                </div>
                {% endfor %}
            </div>
        </div>

        <!-- –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ -->
        <div class="form-section">
            <h2><i class="fas fa-sliders-h"></i> –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏</h2>
            
            <div class="additional-settings">
                <div class="setting-item">
                    <input type="checkbox" id="notifications" name="notifications" checked>
                    <label for="notifications">
                        <i class="fas fa-bell"></i>
                        –ü–æ–ª—É—á–∞—Ç—å —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –æ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞—Ö –º–∞—Ç—á–µ–π
                    </label>
                </div>
                
                <div class="setting-item">
                    <input type="checkbox" id="newsletter" name="newsletter">
                    <label for="newsletter">
                        <i class="fas fa-envelope"></i>
                        –ü–æ–¥–ø–∏—Å–∞—Ç—å—Å—è –Ω–∞ —Å–ø–æ—Ä—Ç–∏–≤–Ω—É—é —Ä–∞—Å—Å—ã–ª–∫—É
                    </label>
                </div>
                
                <div class="setting-item">
                    <input type="checkbox" id="auto-save" name="auto-save" checked>
                    <label for="auto-save">
                        <i class="fas fa-save"></i>
                        –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —Å–æ—Ö—Ä–∞–Ω—è—Ç—å –Ω–∞—Å—Ç—Ä–æ–π–∫–∏
                    </label>
                </div>
            </div>
        </div>

        <!-- –ö–Ω–æ–ø–∫–∏ –¥–µ–π—Å—Ç–≤–∏–π -->
        <div class="form-actions">
            <button type="submit" class="btn btn-primary">
                <i class="fas fa-save"></i> –°–æ—Ö—Ä–∞–Ω–∏—Ç—å –Ω–∞—Å—Ç—Ä–æ–π–∫–∏
            </button>
            <a href="{% url 'home' %}" class="btn btn-outline">
                <i class="fas fa-arrow-left"></i> –ù–∞–∑–∞–¥
            </a>
            <button type="button" class="btn btn-danger" onclick="resetSettings()">
                <i class="fas fa-undo"></i> –°–±—Ä–æ—Å–∏—Ç—å
            </button>
        </div>
    </form>

    <!-- –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ —Ç–µ–∫—É—â–∏—Ö –Ω–∞—Å—Ç—Ä–æ–π–∫–∞—Ö -->
    <div class="current-settings">
        <h3><i class="fas fa-info-circle"></i> –¢–µ–∫—É—â–∏–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏</h3>
        <div class="settings-info">
            <p><strong>–õ—é–±–∏–º—ã—Ö –∫–æ–º–∞–Ω–¥:</strong> {{ favorite_team_ids|length }}</p>
            <p><strong>–Ø–∑—ã–∫:</strong> 
                {% for lang_code, lang_name in language_choices %}
                    {% if lang_code == current_language %}{{ lang_name }}{% endif %}
                {% endfor %}
            </p>
            <p><strong>–¢–µ–º–∞:</strong> 
                {% for theme_code, theme_name in theme_choices %}
                    {% if theme_code == current_theme %}{{ theme_name }}{% endif %}
                {% endfor %}
            </p>
            <p><strong>–ü–æ—Å–ª–µ–¥–Ω–µ–µ –ø–æ—Å–µ—â–µ–Ω–∏–µ:</strong> 
                {% if request.COOKIES.last_visited %}
                    {{ request.COOKIES.last_visited }}
                {% else %}
                    –ü–µ—Ä–≤–æ–µ –ø–æ—Å–µ—â–µ–Ω–∏–µ
                {% endif %}
            </p>
        </div>
    </div>
</div>
{% endblock %}

{% block extra_js %}
<script>
function selectAllTeams() {
    const checkboxes = document.querySelectorAll('input[name="favorite_teams"]');
    checkboxes.forEach(checkbox => {
        checkbox.checked = true;
    });
}

function clearAllTeams() {
    const checkboxes = document.querySelectorAll('input[name="favorite_teams"]');
    checkboxes.forEach(checkbox => {
        checkbox.checked = false;
    });
}

function resetSettings() {
    if (confirm('–í—ã —É–≤–µ—Ä–µ–Ω—ã, —á—Ç–æ —Ö–æ—Ç–∏—Ç–µ —Å–±—Ä–æ—Å–∏—Ç—å –≤—Å–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏?')) {
        // –û—á–∏—â–∞–µ–º –≤—Å–µ —á–µ–∫–±–æ–∫—Å—ã –ª—é–±–∏–º—ã—Ö –∫–æ–º–∞–Ω–¥
        clearAllTeams();
        
        // –°–±—Ä–∞—Å—ã–≤–∞–µ–º —è–∑—ã–∫ –Ω–∞ —Ä—É—Å—Å–∫–∏–π
        document.getElementById('lang-ru').checked = true;
        
        // –°–±—Ä–∞—Å—ã–≤–∞–µ–º —Ç–µ–º—É –Ω–∞ —Å–≤–µ—Ç–ª—É—é
        document.getElementById('theme-light').checked = true;
        
        // –°–±—Ä–∞—Å—ã–≤–∞–µ–º –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏
        document.getElementById('notifications').checked = true;
        document.getElementById('newsletter').checked = false;
        document.getElementById('auto-save').checked = true;
    }
}

// –ü—Ä–µ–¥–≤–∞—Ä–∏—Ç–µ–ª—å–Ω—ã–π –ø—Ä–æ—Å–º–æ—Ç—Ä —Ç–µ–º—ã
document.querySelectorAll('input[name="theme"]').forEach(radio => {
    radio.addEventListener('change', function() {
        if (this.checked) {
            document.body.setAttribute('data-theme', this.value);
        }
    });
});

// –ê–Ω–∏–º–∞—Ü–∏—è –ø—Ä–∏ –≤—ã–±–æ—Ä–µ –∫–æ–º–∞–Ω–¥
document.querySelectorAll('.team-checkbox input').forEach(checkbox => {
    checkbox.addEventListener('change', function() {
        const label = this.nextElementSibling;
        if (this.checked) {
            label.classList.add('selected');
        } else {
            label.classList.remove('selected');
        }
    });
});

// –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –≤—ã–±—Ä–∞–Ω–Ω—ã—Ö –∫–æ–º–∞–Ω–¥ –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ
document.addEventListener('DOMContentLoaded', function() {
    document.querySelectorAll('.team-checkbox input:checked').forEach(checkbox => {
        checkbox.nextElementSibling.classList.add('selected');
    });
});
</script>
{% endblock %}