{% extends 'base.html' %}
{% load static %}

{% block title %}–õ–∏–≥–∏ - –°–ø–æ—Ä—Ç–∏–≤–Ω—ã–µ –§–∞–Ω–∞—Ç—ã{% endblock %}

{% block content %}
<div class="container">
    <div class="leagues-header">
        <h1><i class="fas fa-trophy"></i> –§—É—Ç–±–æ–ª—å–Ω—ã–µ –ª–∏–≥–∏</h1>
        <p>–û–±–∑–æ—Ä –≤—Å–µ—Ö –∫–æ–º–∞–Ω–¥ –ø–æ –ª–∏–≥–∞–º –º–∏—Ä–∞</p>
    </div>

    <div class="leagues-content">
        {% for league, teams in teams_by_league.items %}
        <div class="league-section">
            <div class="league-header">
                <h2>
                    <span class="league-icon">
                        {% if league == "Premier League" %}<i class="fas fa-crown"></i>
                        {% elif league == "La Liga" %}<i class="fas fa-star"></i>
                        {% elif league == "Bundesliga" %}<i class="fas fa-shield-alt"></i>
                        {% elif league == "Serie A" %}<i class="fas fa-flag"></i>
                        {% elif league == "Ligue 1" %}<i class="fas fa-gem"></i>
                        {% else %}<i class="fas fa-trophy"></i>{% endif %}
                    </span>
                    {{ league }}
                </h2>
                <div class="league-info">
                    <span class="team-count">{{ teams|length }} –∫–æ–º–∞–Ω–¥</span>
                    <span class="league-country">
                        {% if league == "Premier League" %}–ê–Ω–≥–ª–∏—è
                        {% elif league == "La Liga" %}–ò—Å–ø–∞–Ω–∏—è
                        {% elif league == "Bundesliga" %}–ì–µ—Ä–º–∞–Ω–∏—è
                        {% elif league == "Serie A" %}–ò—Ç–∞–ª–∏—è
                        {% elif league == "Ligue 1" %}–§—Ä–∞–Ω—Ü–∏—è
                        {% else %}–ú–µ–∂–¥—É–Ω–∞—Ä–æ–¥–Ω–∞—è{% endif %}
                    </span>
                </div>
            </div>
            
            <div class="league-description">
                {% if league == "Premier League" %}
                    <p>–ê–Ω–≥–ª–∏–π—Å–∫–∞—è –ü—Ä–µ–º—å–µ—Ä-–ª–∏–≥–∞ - –æ–¥–Ω–∞ –∏–∑ —Å–∞–º—ã—Ö –ø—Ä–µ—Å—Ç–∏–∂–Ω—ã—Ö —Ñ—É—Ç–±–æ–ª—å–Ω—ã—Ö –ª–∏–≥ –≤ –º–∏—Ä–µ, –∏–∑–≤–µ—Å—Ç–Ω–∞—è —Å–≤–æ–µ–π –∫–æ–Ω–∫—É—Ä–µ–Ω—Ç–Ω–æ—Å—Ç—å—é –∏ –≤—ã—Å–æ–∫–∏–º —É—Ä–æ–≤–Ω–µ–º –∏–≥—Ä—ã.</p>
                {% elif league == "La Liga" %}
                    <p>–ò—Å–ø–∞–Ω—Å–∫–∞—è –õ–∞ –õ–∏–≥–∞ –∏–∑–≤–µ—Å—Ç–Ω–∞ —Å–≤–æ–∏–º —Ç–µ—Ö–Ω–∏—á–Ω—ã–º —Ñ—É—Ç–±–æ–ª–æ–º –∏ –¥–æ–º–æ–º –¥–ª—è –Ω–µ–∫–æ—Ç–æ—Ä—ã—Ö –∏–∑ –≤–µ–ª–∏—á–∞–π—à–∏—Ö –∫–ª—É–±–æ–≤ –º–∏—Ä–∞.</p>
                {% elif league == "Bundesliga" %}
                    <p>–ù–µ–º–µ—Ü–∫–∞—è –ë—É–Ω–¥–µ—Å–ª–∏–≥–∞ —Å–ª–∞–≤–∏—Ç—Å—è —Å–≤–æ–µ–π –æ—Ä–≥–∞–Ω–∏–∑–∞—Ü–∏–µ–π, –∞—Ç–º–æ—Å—Ñ–µ—Ä–æ–π –Ω–∞ —Å—Ç–∞–¥–∏–æ–Ω–∞—Ö –∏ —Ä–∞–∑–≤–∏—Ç–∏–µ–º –º–æ–ª–æ–¥—ã—Ö —Ç–∞–ª–∞–Ω—Ç–æ–≤.</p>
                {% elif league == "Serie A" %}
                    <p>–ò—Ç–∞–ª—å—è–Ω—Å–∫–∞—è –°–µ—Ä–∏—è –ê –∏–∑–≤–µ—Å—Ç–Ω–∞ —Å–≤–æ–µ–π —Ç–∞–∫—Ç–∏—á–µ—Å–∫–æ–π –∏–∑—ã—Å–∫–∞–Ω–Ω–æ—Å—Ç—å—é –∏ —Å–∏–ª—å–Ω–æ–π –æ–±–æ—Ä–æ–Ω–æ–π.</p>
                {% elif league == "Ligue 1" %}
                    <p>–§—Ä–∞–Ω—Ü—É–∑—Å–∫–∞—è –õ–∏–≥–∞ 1 —è–≤–ª—è–µ—Ç—Å—è –¥–æ–º–æ–º –¥–ª—è –º–Ω–æ–≥–∏—Ö –º–æ–ª–æ–¥—ã—Ö —Ç–∞–ª–∞–Ω—Ç–æ–≤ –∏ —Ä–∞–∑–≤–∏–≤–∞—é—â–∏—Ö—Å—è –∑–≤–µ–∑–¥ —Ñ—É—Ç–±–æ–ª–∞.</p>
                {% endif %}
            </div>

            <div class="teams-grid">
                {% for team in teams %}
                <div class="team-card league-team">
                    <div class="team-logo">
                        <img src="{% static 'images/teams/' %}{{ team.logo }}" 
                             alt="{{ team.name }}" 
                             onerror="this.src='{% static 'images/default-team.png' %}'">
                    </div>
                    <div class="team-info">
                        <h3>{{ team.name }}</h3>
                        <p class="team-country">
                            <i class="fas fa-map-marker-alt"></i> {{ team.country }}
                        </p>
                        <p class="team-founded">–û—Å–Ω–æ–≤–∞–Ω: {{ team.founded }}</p>
                        <p class="team-description-short">{{ team.description|truncatechars:80 }}</p>
                    </div>
                    <div class="team-actions">
                        <a href="{% url 'team_detail' team.id %}" class="btn btn-sm btn-primary">
                            <i class="fas fa-info-circle"></i> –ü–æ–¥—Ä–æ–±–Ω–µ–µ
                        </a>
                        <button class="btn btn-sm btn-outline" onclick="toggleFavorite({{ team.id }})" id="favorite-btn-{{ team.id }}">
                            <i class="fas fa-heart"></i> –í –∏–∑–±—Ä–∞–Ω–Ω–æ–µ
                        </button>
                    </div>
                </div>
                {% endfor %}
            </div>

            <!-- –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –ª–∏–≥–∏ -->
            <div class="league-stats">
                <div class="stat-item">
                    <i class="fas fa-users"></i>
                    <span>{{ teams|length }} –∫–æ–º–∞–Ω–¥</span>
                </div>
                <div class="stat-item">
                    <i class="fas fa-calendar"></i>
                    <span>–°–µ–∑–æ–Ω 2024-25</span>
                </div>
                <div class="stat-item">
                    <i class="fas fa-trophy"></i>
                    <span>–ü—Ä–µ—Å—Ç–∏–∂–Ω–∞—è –ª–∏–≥–∞</span>
                </div>
            </div>
        </div>
        {% endfor %}
    </div>

    <!-- –û–±—â–∞—è —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ -->
    <div class="overall-stats">
        <h2><i class="fas fa-chart-pie"></i> –û–±—â–∞—è —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞</h2>
        <div class="stats-grid">
            <div class="stat-card">
                <div class="stat-icon">
                    <i class="fas fa-globe"></i>
                </div>
                <div class="stat-info">
                    <h3>{{ teams_by_league|length }}</h3>
                    <p>–õ–∏–≥ –≤ –±–∞–∑–µ</p>
                </div>
            </div>
            <div class="stat-card">
                <div class="stat-icon">
                    <i class="fas fa-users"></i>
                </div>
                <div class="stat-info">
                    <h3>
                        {% for league, teams in teams_by_league.items %}
                            {% if forloop.first %}{{ teams|length }}
                            {% else %}{% endif %}
                        {% endfor %}
                        {% for league, teams in teams_by_league.items %}
                            {% if not forloop.first %}+{{ teams|length }}{% endif %}
                        {% endfor %}
                    </h3>
                    <p>–í—Å–µ–≥–æ –∫–æ–º–∞–Ω–¥</p>
                </div>
            </div>
            <div class="stat-card">
                <div class="stat-icon">
                    <i class="fas fa-flag"></i>
                </div>
                <div class="stat-info">
                    <h3>5</h3>
                    <p>–°—Ç—Ä–∞–Ω</p>
                </div>
            </div>
            <div class="stat-card">
                <div class="stat-icon">
                    <i class="fas fa-star"></i>
                </div>
                <div class="stat-info">
                    <h3>TOP</h3>
                    <p>–ö–∞—á–µ—Å—Ç–≤–æ</p>
                </div>
            </div>
        </div>
    </div>

    <!-- –°—Ä–∞–≤–Ω–µ–Ω–∏–µ –ª–∏–≥ -->
    <div class="leagues-comparison">
        <h2><i class="fas fa-balance-scale"></i> –°—Ä–∞–≤–Ω–µ–Ω–∏–µ –ª–∏–≥</h2>
        <div class="comparison-table">
            <table>
                <thead>
                    <tr>
                        <th>–õ–∏–≥–∞</th>
                        <th>–°—Ç—Ä–∞–Ω–∞</th>
                        <th>–ö–æ–º–∞–Ω–¥</th>
                        <th>–£—Ä–æ–≤–µ–Ω—å</th>
                        <th>–ü–æ–ø—É–ª—è—Ä–Ω–æ—Å—Ç—å</th>
                    </tr>
                </thead>
                <tbody>
                    {% for league, teams in teams_by_league.items %}
                    <tr>
                        <td>
                            <span class="league-name">
                                {% if league == "Premier League" %}<i class="fas fa-crown"></i>
                                {% elif league == "La Liga" %}<i class="fas fa-star"></i>
                                {% elif league == "Bundesliga" %}<i class="fas fa-shield-alt"></i>
                                {% elif league == "Serie A" %}<i class="fas fa-flag"></i>
                                {% elif league == "Ligue 1" %}<i class="fas fa-gem"></i>
                                {% else %}<i class="fas fa-trophy"></i>{% endif %}
                                {{ league }}
                            </span>
                        </td>
                        <td>
                            {% if league == "Premier League" %}üá¨üáß –ê–Ω–≥–ª–∏—è
                            {% elif league == "La Liga" %}üá™üá∏ –ò—Å–ø–∞–Ω–∏—è
                            {% elif league == "Bundesliga" %}üá©üá™ –ì–µ—Ä–º–∞–Ω–∏—è
                            {% elif league == "Serie A" %}üáÆüáπ –ò—Ç–∞–ª–∏—è
                            {% elif league == "Ligue 1" %}üá´üá∑ –§—Ä–∞–Ω—Ü–∏—è
                            {% else %}üåç –ú–µ–∂–¥—É–Ω–∞—Ä–æ–¥–Ω–∞—è{% endif %}
                        </td>
                        <td>{{ teams|length }}</td>
                        <td>
                            <div class="rating">
                                {% if league == "Premier League" or league == "La Liga" %}
                                    <i class="fas fa-star"></i><i class="fas fa-star"></i><i class="fas fa-star"></i><i class="fas fa-star"></i><i class="fas fa-star"></i>
                                {% elif league == "Bundesliga" or league == "Serie A" %}
                                    <i class="fas fa-star"></i><i class="fas fa-star"></i><i class="fas fa-star"></i><i class="fas fa-star"></i><i class="far fa-star"></i>
                                {% else %}
                                    <i class="fas fa-star"></i><i class="fas fa-star"></i><i class="fas fa-star"></i><i class="far fa-star"></i><i class="far fa-star"></i>
                                {% endif %}
                            </div>
                        </td>
                        <td>
                            <div class="popularity-bar">
                                <div class="popularity-fill" style="width: {% if league == 'Premier League' %}95{% elif league == 'La Liga' %}90{% elif league == 'Bundesliga' %}85{% elif league == 'Serie A' %}80{% else %}75{% endif %}%"></div>
                            </div>
                        </td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
        </div>
    </div>
</div>
{% endblock %}

{% block extra_js %}
<script>
function toggleFavorite(teamId) {
    fetch('{% url "toggle_favorite" %}', {
        method: 'POST',
        headers: {
            'Content-Type': 'application/json',
        },
        body: JSON.stringify({
            team_id: teamId
        })
    })
    .then(response => response.json())
    .then(data => {
        if (data.success) {
            const btn = document.getElementById(`favorite-btn-${teamId}`);
            if (data.is_favorite) {
                btn.classList.remove('btn-outline');
                btn.classList.add('btn-danger');
                btn.innerHTML = '<i class="fas fa-heart"></i> –£–±—Ä–∞—Ç—å';
            } else {
                btn.classList.remove('btn-danger');
                btn.classList.add('btn-outline');
                btn.innerHTML = '<i class="fas fa-heart"></i> –í –∏–∑–±—Ä–∞–Ω–Ω–æ–µ';
            }
            
            showNotification(data.message, data.is_favorite ? 'success' : 'info');
        } else {
            showNotification('–û—à–∏–±–∫–∞ –ø—Ä–∏ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–∏ –∏–∑–±—Ä–∞–Ω–Ω–æ–≥–æ', 'error');
        }
    })
    .catch(error => {
        console.error('Error:', error);
        showNotification('–ü—Ä–æ–∏–∑–æ—à–ª–∞ –æ—à–∏–±–∫–∞', 'error');
    });
}

function showNotification(message, type) {
    const notification = document.createElement('div');
    notification.className = `notification notification-${type}`;
    notification.textContent = message;
    
    notification.style.cssText = `
        position: fixed;
        top: 20px;
        right: 20px;
        padding: 15px 20px;
        border-radius: 5px;
        color: white;
        font-weight: bold;
        z-index: 1000;
        opacity: 0;
        transition: opacity 0.3s ease;
    `;
    
    if (type === 'success') notification.style.backgroundColor = '#4CAF50';
    else if (type === 'error') notification.style.backgroundColor = '#f44336';
    else notification.style.backgroundColor = '#2196F3';
    
    document.body.appendChild(notification);
    
    setTimeout(() => notification.style.opacity = '1', 100);
    
    setTimeout(() => {
        notification.style.opacity = '0';
        setTimeout(() => {
            if (notification.parentNode) {
                notification.parentNode.removeChild(notification);
            }
        }, 300);
    }, 3000);
}
</script>
{% endblock %}