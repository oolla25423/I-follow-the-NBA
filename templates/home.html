{% extends 'base.html' %}
{% load static %}
{% load i18n_fallback %}

{% block title %}{% trans "Home" %} - {% trans "I follow the NBA" %}{% endblock %}

{% block content %}
<div class="nba-hero-fullwidth">
    <div class="nba-hero-image">
        <img src="{% static 'images/nba.jpeg' %}" alt="NBA Basketball" class="hero-img">
    </div>
</div>

<div class="container">
    <section class="teams-section">
        <div class="section-header">
            <div class="filter-controls">
                <button class="btn filter-btn active" data-filter="favorites" onclick="window.location.reload(); return false;">
                    <i class="fas fa-heart"></i> {% trans "Favorites Only" %}
                </button>
                <button class="btn filter-btn" data-filter="all">
                    <i class="fas fa-list"></i> {% trans "All Teams" %}
                </button>
            </div>
            <p>{% trans "Click the heart icon to add teams to your favorites" %}</p>
        </div>

        <div class="search-bar" id="searchBar" style="display: none;">
            <form method="get" id="searchForm">
                {{ search_form.search }}
                <button type="submit" class="search-btn">
                    <i class="fas fa-search"></i>
                </button>
            </form>
        </div>

        <div class="teams-grid">
            {% for team in teams %}
            <div class="team-card" data-team-id="{{ team.id }}" data-is-favorite="{% if team.is_favorite %}true{% else %}false{% endif %}">
                <div class="team-header">
                    <div class="team-logo">
                        <div class="team-initials" data-color1="{{ team.colors.0 }}" data-color2="{{ team.colors.1|default:team.colors.0 }}">
                        </div>
                    </div>
                    <button class="favorite-btn toggle-favorite-btn {% if team.is_favorite %}active{% endif %}" 
                            data-team-id="{{ team.id }}"
                            title="{% if team.is_favorite %}{% trans 'Remove from favorites' %}{% else %}{% trans 'Add to favorites' %}{% endif %}">
                        <i class="{% if team.is_favorite %}fas{% else %}far{% endif %} fa-heart"></i>
                    </button>
                </div>
                
                <div class="team-info">
                    <h3 class="team-name">{{ team.name }}</h3>
                    <p class="team-city"><i class="fas fa-map-marker-alt"></i> {{ team.city }}</p>
                    
                    <div class="team-details">
                        <div class="detail-item">
                            <span class="detail-label">{% trans "Conference:" %}</span>
                            <span class="detail-value">{{ team.conference }}</span>
                        </div>
                        <div class="detail-item">
                            <span class="detail-label">{% trans "Division:" %}</span>
                            <span class="detail-value">{{ team.division }}</span>
                        </div>
                    </div>
                    
                    <button class="btn btn-primary team-info-btn" data-team-id="{{ team.id }}">
                        <i class="fas fa-info-circle"></i>
                        {% trans "Quick Info" %}
                    </button>
                </div>
            </div>
            {% empty %}
            <div class="no-teams">
                <i class="fas fa-basketball-ball"></i>
                <h3>{% trans "No teams available" %}</h3>
                <p>{% trans "Please check back later for team information." %}</p>
            </div>
            {% endfor %}
        </div>
    </section>
</div>

<div id="teamModal" class="modal">
    <div class="modal-content">
        <div class="modal-header">
            <span class="close" data-modal-close>&times;</span>
            <h2 id="modalTeamName"></h2>
        </div>
        <div class="modal-body">
            <div class="modal-team-logo">
                <div id="modalTeamInitials" class="team-initials-modal"></div>
            </div>
            <div class="modal-team-info">
                <p class="modal-team-location">
                    <i class="fas fa-map-marker-alt"></i>
                    <span id="modalTeamCity"></span>
                </p>
                <div class="modal-team-badges">
                    <span id="modalConference" class="badge conference-badge"></span>
                    <span id="modalDivision" class="badge division-badge"></span>
                </div>
                <p id="modalTeamDescription" class="team-description"></p>
            </div>
        </div>
    </div>
</div>
{% endblock %}

{% block extra_js %}
<script>
// Initialize favorites filter on page load
document.addEventListener('DOMContentLoaded', function() {
    // Apply team colors from data attributes
    document.querySelectorAll('.team-initials[data-color1]').forEach(element => {
        const color1 = element.dataset.color1;
        const color2 = element.dataset.color2;
        element.style.background = `linear-gradient(135deg, ${color1}, ${color2})`;
    });
    
    // Add close modal handler
    const closeBtn = document.querySelector('[data-modal-close]');
    if (closeBtn) {
        closeBtn.addEventListener('click', closeTeamModal);
    }
    
    // Add filter button handlers
    const filterButtons = document.querySelectorAll('.filter-btn');
    console.log('Found filter buttons:', filterButtons.length);
    filterButtons.forEach(btn => {
        console.log('Adding click handler to button:', btn);
        btn.addEventListener('click', function() {
            const filter = this.dataset.filter;
            console.log('Filter clicked:', filter);
            if (window.filterTeams && typeof window.filterTeams === 'function') {
                window.filterTeams(filter);
            }
            
            // Show search bar only for "all teams" filter
            const searchBar = document.getElementById('searchBar');
            if (searchBar) {
                if (filter === 'all') {
                    searchBar.style.display = 'block';
                } else {
                    searchBar.style.display = 'none';
                    // Clear search when switching to favorites
                    const searchInput = document.getElementById('searchInput');
                    if (searchInput) {
                        searchInput.value = '';
                        // Trigger input event to clear search results
                        searchInput.dispatchEvent(new Event('input'));
                    }
                }
            }
        });
    });
    
    // –í—Å–µ–≥–¥–∞ –ø–æ–∫–∞–∑—ã–≤–∞—Ç—å –∏–∑–±—Ä–∞–Ω–Ω—ã–µ –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ —Å—Ç—Ä–∞–Ω–∏—Ü—ã (–≤–º–µ—Å—Ç–æ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–Ω–æ–≥–æ —Å–æ—Å—Ç–æ—è–Ω–∏—è)
    setTimeout(() => {
        // –í—Å–µ–≥–¥–∞ —É—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞—Ç—å —Ñ–∏–ª—å—Ç—Ä –≤ 'favorites' –≤–º–µ—Å—Ç–æ –ø—Ä–æ–≤–µ—Ä–∫–∏ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–Ω–æ–≥–æ —Å–æ—Å—Ç–æ—è–Ω–∏—è
        if (window.filterTeams && typeof window.filterTeams === 'function') {
            window.filterTeams('favorites');
        }
    }, 100);
});

// Local getCookie function
function getCookie(name) {
    let cookieValue = null;
    if (document.cookie && document.cookie !== '') {
        const cookies = document.cookie.split(';');
        for (let i = 0; i < cookies.length; i++) {
            const cookie = cookies[i].trim();
            if (cookie.substring(0, name.length + 1) === (name + '=')) {
                cookieValue = decodeURIComponent(cookie.substring(name.length + 1));
                break;
            }
        }
    }
    return cookieValue;
}

// Show team info in modal
function showTeamInfo(teamId) {
    try {
        // Find team data from the current page
        const teamCard = document.querySelector(`[data-team-id="${teamId}"]`);
        if (!teamCard) {
            console.error('Team card not found for ID:', teamId);
            return;
        }
        
        const teamName = teamCard.querySelector('.team-name').textContent;
        const teamCity = teamCard.querySelector('.team-city').textContent.replace('üìç', '').trim();
        const conferenceValue = teamCard.querySelector('.detail-item:first-child .detail-value').textContent;
        const divisionValue = teamCard.querySelector('.detail-item:last-child .detail-value').textContent;
        const teamInitials = teamCard.querySelector('.team-initials');
        const teamColors = teamInitials.style.background;
        
        // Get current language first
        const currentLang = getCookie('django_language') || 'en';
        
        // Set modal content
        document.getElementById('modalTeamName').textContent = teamName;
        document.getElementById('modalTeamCity').textContent = teamCity;
        
        // Set conference and division with proper language
        if (currentLang === 'ru') {
            document.getElementById('modalConference').textContent = conferenceValue + ' –ö–æ–Ω—Ñ–µ—Ä–µ–Ω—Ü–∏—è';
            document.getElementById('modalDivision').textContent = divisionValue + ' –î–∏–≤–∏–∑–∏–æ–Ω';
        } else {
            document.getElementById('modalConference').textContent = conferenceValue + ' Conference';
            document.getElementById('modalDivision').textContent = divisionValue + ' Division';
        }
        document.getElementById('modalTeamInitials').textContent = '';
        document.getElementById('modalTeamInitials').style.background = teamColors;
        
        // Set description based on language (simple 3-sentence description)
        let description;
        if (currentLang === 'ru') {
            const descriptions = {
                1: `${teamName} ‚Äî —ç—Ç–æ –ø—Ä–æ—Ñ–µ—Å—Å–∏–æ–Ω–∞–ª—å–Ω–∞—è –±–∞—Å–∫–µ—Ç–±–æ–ª—å–Ω–∞—è –∫–æ–º–∞–Ω–¥–∞ –∏–∑ –≥–æ—Ä–æ–¥–∞ ${teamCity}. –û–Ω–∏ –≤—ã—Å—Ç—É–ø–∞—é—Ç –≤ ${conferenceValue} –ö–æ–Ω—Ñ–µ—Ä–µ–Ω—Ü–∏–∏, ${divisionValue} –î–∏–≤–∏–∑–∏–æ–Ω. –ò–∑–≤–µ—Å—Ç–Ω—ã —Å–≤–æ–∏–º —Å–æ—Ä–µ–≤–Ω–æ–≤–∞—Ç–µ–ª—å–Ω—ã–º –¥—É—Ö–æ–º –∏ –ø—Ä–µ–¥–∞–Ω–Ω—ã–º–∏ –±–æ–ª–µ–ª—å—â–∏–∫–∞–º–∏.`,
                2: `–ë–∞–∑–∏—Ä—É–µ—Ç—Å—è –≤ ${teamCity}, ${teamName} –ø—Ä–µ–¥—Å—Ç–∞–≤–ª—è–µ—Ç ${divisionValue} –î–∏–≤–∏–∑–∏–æ–Ω. –ö–æ–º–∞–Ω–¥–∞ –∏–º–µ–µ—Ç –±–æ–≥–∞—Ç—É—é –∏—Å—Ç–æ—Ä–∏—é –≤ –ø—Ä–æ—Ñ–µ—Å—Å–∏–æ–Ω–∞–ª—å–Ω–æ–º –±–∞—Å–∫–µ—Ç–±–æ–ª–µ. –û–Ω–∏ –ø—Ä–æ–¥–æ–ª–∂–∞—é—Ç —Å—Ç—Ä–µ–º–∏—Ç—å—Å—è –∫ —Å–æ–≤–µ—Ä—à–µ–Ω—Å—Ç–≤—É –≤ –∫–∞–∂–¥–æ–º —Å–µ–∑–æ–Ω–µ.`,
                3: `${teamName} –Ω–∞–∑—ã–≤–∞–µ—Ç ${teamCity} –¥–æ–º–æ–º –∏ –∏–≥—Ä–∞–µ—Ç –≤ ${conferenceValue} –ö–æ–Ω—Ñ–µ—Ä–µ–Ω—Ü–∏–∏. –≠—Ç–∞ —Ñ—Ä–∞–Ω—à–∏–∑–∞ —Å–æ–∑–¥–∞–ª–∞ –ø—Ä–æ—á–Ω—É—é —Ä–µ–ø—É—Ç–∞—Ü–∏—é –∑–∞ —ç—Ç–∏ –≥–æ–¥—ã. –ò—Ö –±–æ–ª–µ–ª—å—â–∏–∫–∏ –æ–¥–Ω–∏ –∏–∑ —Å–∞–º—ã—Ö —Å—Ç—Ä–∞—Å—Ç–Ω—ã—Ö –≤ –±–∞—Å–∫–µ—Ç–±–æ–ª–µ.`,
                4: `–û—Å–Ω–æ–≤–∞–Ω–Ω–∞—è –≤ 1966 –≥–æ–¥—É, ${teamName} –∏–∑ ${teamCity} –∏–º–µ–µ—Ç –±–æ–≥–∞—Ç—É—é –∏—Å—Ç–æ—Ä–∏—é –≤ –ù–ë–ê. –ö–æ–º–∞–Ω–¥–∞ –≤—ã—Å—Ç—É–ø–∞–µ—Ç –≤ ${conferenceValue} –ö–æ–Ω—Ñ–µ—Ä–µ–Ω—Ü–∏–∏, ${divisionValue} –î–∏–≤–∏–∑–∏–æ–Ω. –ò–∑–≤–µ—Å—Ç–Ω–∞ —Å–≤–æ–∏–º–∏ —à–µ—Å—Ç—å—é —á–µ–º–ø–∏–æ–Ω—Å–∫–∏–º–∏ —Ç–∏—Ç—É–ª–∞–º–∏ –∏ —ç–ø–æ—Ö–æ–π –ú–∞–π–∫–ª–∞ –î–∂–æ—Ä–¥–∞–Ω–∞.`,
                5: `${teamName} –∏–∑ ${teamCity} –≤—ã—Å—Ç—É–ø–∞–µ—Ç –≤ ${conferenceValue} –ö–æ–Ω—Ñ–µ—Ä–µ–Ω—Ü–∏–∏, ${divisionValue} –î–∏–≤–∏–∑–∏–æ–Ω. –ö–æ–º–∞–Ω–¥–∞ –∏–∑–≤–µ—Å—Ç–Ω–∞ —Å–≤–æ–µ–π "–∫—É–ª—å—Ç—É—Ä–æ–π Heat" –∏ –Ω–µ—Å–∫–æ–ª—å–∫–∏–º–∏ —á–µ–º–ø–∏–æ–Ω—Å–∫–∏–º–∏ —Ç–∏—Ç—É–ª–∞–º–∏. –û—Å–Ω–æ–≤–∞–Ω–∞ –≤ 1988 –≥–æ–¥—É –∏ –∏–º–µ–µ—Ç –ø—Ä–µ–¥–∞–Ω–Ω—É—é —Ñ–∞–Ω–±–∞–∑—É.`,
                6: `${teamName} –∏–∑ ${teamCity} –≤—ã—Å—Ç—É–ø–∞–µ—Ç –≤ ${conferenceValue} –ö–æ–Ω—Ñ–µ—Ä–µ–Ω—Ü–∏–∏, ${divisionValue} –î–∏–≤–∏–∑–∏–æ–Ω. –°–æ–≤—Ä–µ–º–µ–Ω–Ω–∞—è —Ñ—Ä–∞–Ω—à–∏–∑–∞, –∏–∑–≤–µ—Å—Ç–Ω–∞—è –∑–≤–µ–∑–¥–Ω—ã–º–∏ —Å–æ—Å—Ç–∞–≤–∞–º–∏ –∏ —Ö–∞—Ä–∞–∫—Ç–µ—Ä–Ω–æ–π —á–µ—Ä–Ω–æ–π —Ñ–æ—Ä–º–æ–π. –û—Å–Ω–æ–≤–∞–Ω–∞ –≤ 1967 –≥–æ–¥—É.`,
                7: `–ë–∞–∑–∏—Ä—É–µ—Ç—Å—è –≤ ${teamCity}, ${teamName} –ø—Ä–µ–¥—Å—Ç–∞–≤–ª—è–µ—Ç ${divisionValue} –î–∏–≤–∏–∑–∏–æ–Ω. –ö–æ–º–∞–Ω–¥–∞ –∏–∑–≤–µ—Å—Ç–Ω–∞ —Å—Ç—Ä–∞—Å—Ç–Ω–æ–π —Ñ–∞–Ω–±–∞–∑–æ–π –∏ –Ω–µ–¥–∞–≤–Ω–∏–º —á–µ–º–ø–∏–æ–Ω—Å–∫–∏–º —É—Å–ø–µ—Ö–æ–º —Å –ì–∏–∞–Ω–Ω–∏—Å–æ–º –ê–Ω—Ç–µ—Ç–æ–∫—É–º–ø–æ. –û—Å–Ω–æ–≤–∞–Ω–∞ –≤ 1968 –≥–æ–¥—É.`,
                8: `${teamName} –Ω–∞–∑—ã–≤–∞–µ—Ç ${teamCity} –¥–æ–º–æ–º –∏ –∏–≥—Ä–∞–µ—Ç –≤ ${conferenceValue} –ö–æ–Ω—Ñ–µ—Ä–µ–Ω—Ü–∏–∏. –≠—Ç–∞ —Ñ—Ä–∞–Ω—à–∏–∑–∞ –∏–∑–≤–µ—Å—Ç–Ω–∞ —Å–≤–æ–∏–º–∏ –æ—Ä–∞–Ω–∂–µ–≤—ã–º–∏ –∏ —Ñ–∏–æ–ª–µ—Ç–æ–≤—ã–º–∏ —Ü–≤–µ—Ç–∞–º–∏ –∏ –±—ã—Å—Ç—Ä—ã–º —Å—Ç–∏–ª–µ–º –∏–≥—Ä—ã "–°–µ–º—å —Å–µ–∫—É–Ω–¥ –∏–ª–∏ –º–µ–Ω—å—à–µ". –û—Å–Ω–æ–≤–∞–Ω–∞ –≤ 1968 –≥–æ–¥—É.`,
                9: `${teamName} –∏–∑ ${teamCity} –≤—ã—Å—Ç—É–ø–∞–µ—Ç –≤ ${conferenceValue} –ö–æ–Ω—Ñ–µ—Ä–µ–Ω—Ü–∏–∏, ${divisionValue} –î–∏–≤–∏–∑–∏–æ–Ω. –ö–æ–º–∞–Ω–¥–∞ –∏–∑–≤–µ—Å—Ç–Ω–∞ —Å–≤–æ–∏–º —É–Ω–∏–∫–∞–ª—å–Ω—ã–º —Å—Ç–∏–ª–µ–º –∏ —á–µ–º–ø–∏–æ–Ω—Å–∫–∏–º —Ç—É—Ä–æ–º –ø–æ–¥ —Ä—É–∫–æ–≤–æ–¥—Å—Ç–≤–æ–º –î–∏—Ä–∫–∞ –ù–æ–≤–∏—Ü–∫–∏. –û—Å–Ω–æ–≤–∞–Ω–∞ –≤ 1980 –≥–æ–¥—É.`,
                10: `–û—Å–Ω–æ–≤–∞–Ω–Ω–∞—è –≤ 1976 –≥–æ–¥—É, ${teamName} –∏–∑ ${teamCity} –∏–º–µ–µ—Ç –≥–æ—Ä–Ω—É—é –∏–¥–µ–Ω—Ç–∏—á–Ω–æ—Å—Ç—å –∏ –Ω–µ–¥–∞–≤–Ω–∏–π —á–µ–º–ø–∏–æ–Ω—Å–∫–∏–π —É—Å–ø–µ—Ö —Å –ù–∏–∫–æ–ª–æ–π –ô–æ–∫–∏—á–µ–º. –ö–æ–º–∞–Ω–¥–∞ –≤—ã—Å—Ç—É–ø–∞–µ—Ç –≤ ${conferenceValue} –ö–æ–Ω—Ñ–µ—Ä–µ–Ω—Ü–∏–∏, ${divisionValue} –î–∏–≤–∏–∑–∏–æ–Ω.`
            };
            description = descriptions[teamId] || descriptions[1];
        } else {
            const descriptions = {
                1: `The ${teamName} is a professional basketball team based in ${teamCity}. They compete in the ${conferenceValue} Conference, ${divisionValue} Division. Known for their competitive spirit and dedicated fanbase.`,
                2: `Based in ${teamCity}, the ${teamName} represents the ${divisionValue} Division. The team has a rich history in professional basketball. They continue to strive for excellence in every season.`,
                3: `The ${teamName} calls ${teamCity} home and plays in the ${conferenceValue} Conference. This franchise has built a strong reputation over the years. Their fans are among the most passionate in basketball.`,
                4: `Founded in 1966, the ${teamName} from ${teamCity} has a rich history in the NBA. The team competes in the ${conferenceValue} Conference, ${divisionValue} Division. Known for their six championship titles and the Michael Jordan era.`,
                5: `The ${teamName} from ${teamCity} competes in the ${conferenceValue} Conference, ${divisionValue} Division. The team is known for their "Heat Culture" and multiple championship runs. Founded in 1988 with a dedicated fanbase.`,
                6: `The ${teamName} from ${teamCity} competes in the ${conferenceValue} Conference, ${divisionValue} Division. A modern franchise known for star-studded rosters and distinctive black uniforms. Founded in 1967.`,
                7: `Based in ${teamCity}, the ${teamName} represents the ${divisionValue} Division. Known for their passionate fanbase and recent championship success with Giannis Antetokounmpo. Founded in 1968.`,
                8: `The ${teamName} calls ${teamCity} home and plays in the ${conferenceValue} Conference. This franchise is known for their orange and purple colors and fast-paced "Seven Seconds or Less" style of play. Founded in 1968.`,
                9: `The ${teamName} from ${teamCity} competes in the ${conferenceValue} Conference, ${divisionValue} Division. Known for their unique style and championship run led by Dirk Nowitzki. Founded in 1980.`,
                10: `Founded in 1976, the ${teamName} from ${teamCity} has a mountain-inspired identity and recent championship success with Nikola Jokiƒá. The team competes in the ${conferenceValue} Conference, ${divisionValue} Division.`
            };
            description = descriptions[teamId] || descriptions[1];
        }
        
        document.getElementById('modalTeamDescription').textContent = description;
        
        // Show modal
        document.getElementById('teamModal').style.display = 'block';
    } catch (error) {
        console.error('Error showing team info:', error);
        alert('–û—à–∏–±–∫–∞ –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏ –æ –∫–æ–º–∞–Ω–¥–µ. –ü–æ–ø—Ä–æ–±—É–π—Ç–µ –µ—â–µ —Ä–∞–∑.');
    }
}

function closeTeamModal() {
    document.getElementById('teamModal').style.display = 'none';
}

// Close modal when clicking outside of it
window.onclick = function(event) {
    const modal = document.getElementById('teamModal');
    if (event.target === modal) {
        closeTeamModal();
    }
}
</script>
{% endblock %}